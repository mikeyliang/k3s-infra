# chart: immich/immich
# install: helm install immich immich/immich -n app-internal -f values.yaml
# upgrade: helm upgrade immich immich/immich -n app-internal -f values.yaml

# Disable built-in valkey
valkey:
  enabled: false

# Immich configuration
immich:
  persistence:
    library:
      existingClaim: immich-library

# Server component
server:
  enabled: true

  controllers:
    main:
      containers:
        main:
          image:
            tag: v2.2.3
          env:
            TZ: America/New_York
            IMMICH_LOG_LEVEL: log
            REDIS_HOSTNAME: redis.database.svc.cluster.local
            REDIS_PORT: "6379"
            REDIS_PASSWORD:
              valueFrom:
                secretKeyRef:
                  name: immich-redis
                  key: password
            DB_HOSTNAME: postgres-cluster-rw.database.svc.cluster.local
            DB_PORT: "5432"
            DB_DATABASE_NAME: immich
            DB_USERNAME: immich
            DB_PASSWORD:
              valueFrom:
                secretKeyRef:
                  name: immich-db
                  key: password
            IMMICH_MACHINE_LEARNING_URL: http://immich-machine-learning:3003
          resources:
            requests:
              cpu: 200m
              memory: 512Mi
            limits:
              cpu: 2000m
              memory: 2Gi

  service:
    main:
      type: ClusterIP
      ports:
        http:
          port: 3001

  ingress:
    main:
      enabled: false

# Machine learning component
machine-learning:
  enabled: true

  controllers:
    main:
      containers:
        main:
          image:
            tag: v2.2.3
          env:
            TRANSFORMERS_CACHE: /cache
          resources:
            requests:
              cpu: 500m
              memory: 1Gi
            limits:
              cpu: 4000m
              memory: 4Gi

  persistence:
    cache:
      type: persistentVolumeClaim
      existingClaim: immich-ml-cache
      globalMounts:
        - path: /cache
