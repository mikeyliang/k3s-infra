# Chart: bitnami/redis
# Install: helm install redis bitnami/redis -n database -f redis-values.yaml
# Upgrade: helm upgrade redis bitnami/redis -n database -f redis-values.yaml

# Architecture: standalone or replication
architecture: standalone # Change to "replication" for master-replica setup

# Image - pinned versions for production
image:
  registry: docker.io
  repository: bitnami/redis
  tag: 7.4.1-debian-12-r0 # Pin to specific version

# Authentication
auth:
  enabled: true
  password: "FR1UUY+YeRSbJpeFz1QZqjW448MjuzhdPL2iokGrTYk=" # Generate with: openssl rand -base64 32

# Master configuration
master:
  # Resource limits
  resources:
    requests:
      memory: "256Mi"
      cpu: "100m"
    limits:
      memory: "1Gi"
      cpu: "1000m"

  # persistence with longhorn - using external pvc
  persistence:
    enabled: true
    existingClaim: "redis-data"

  # Redis configuration
  configuration: |-
    maxmemory 768mb
    maxmemory-policy allkeys-lru
    save 900 1
    save 300 10
    save 60 10000

  # Service configuration
  service:
    type: LoadBalancer
    loadBalancerIP: 10.3.0.55 # Pick an available IP from your MetalLB pool
    annotations:
      metallb.universe.tf/address-pool: app-database

# Sentinel configuration (if using replication)
sentinel:
  enabled: true # Enable if using replication architecture
  image:
    registry: docker.io
    repository: bitnami/redis-sentinel
    tag: 7.4.1-debian-12-r0

# Metrics (optional - for monitoring)
metrics:
  enabled: true
  image:
    registry: docker.io
    repository: bitnami/redis-exporter
    tag: 1.66.0-debian-12-r1
  serviceMonitor:
    enabled: false # Set true if using Prometheus Operator
  resources:
    requests:
      memory: "64Mi"
      cpu: "50m"
    limits:
      memory: "128Mi"
      cpu: "200m"

# Security
securityContext:
  enabled: true
  fsGroup: 1001
  runAsUser: 1001

containerSecurityContext:
  enabled: true
  runAsUser: 1001
  runAsNonRoot: true

# Volume permissions (fixes permission issues)
volumePermissions:
  enabled: true
  image:
    registry: docker.io
    repository: bitnami/os-shell
    tag: 12-debian-12-r32

# Sysctl image (for kernel parameter tuning)
sysctl:
  enabled: false
  image:
    registry: docker.io
    repository: bitnami/os-shell
    tag: 12-debian-12-r32

# TLS (optional - enable if needed)
tls:
  enabled: false

# Common labels
commonLabels:
  app.kubernetes.io/component: redis
  app.kubernetes.io/part-of: infrastructure
